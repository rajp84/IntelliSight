<div class="flex items-center justify-between mb-3">
  <div class="text-sm text-gray-600">
    <ng-container *ngIf="currentPath; else rootLabel">
      <ng-container *ngFor="let seg of currentPath.split('/'); let i = index">
        <button class="text-blue-600 hover:underline" (click)="load(currentPath.split('/').slice(0, i + 1).join('/'))">{{ seg }}</button>
        <span *ngIf="i < currentPath.split('/').length - 1" class="text-gray-400"> / </span>
      </ng-container>
    </ng-container>
    <ng-template #rootLabel>
      <span>/</span>
    </ng-template>
  </div>
  <div class="flex items-center gap-3">
    <button class="text-sm text-blue-600 hover:underline" (click)="up()" [disabled]="!currentPath">Up one level</button>
    <button class="text-sm text-blue-600 hover:underline" (click)="load('')">Root</button>
  </div>
</div>

<div *ngIf="loading" class="text-sm text-gray-500">Loading...</div>
<div *ngIf="error" class="text-sm text-red-600">{{ error }}</div>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
  <ul class="divide-y divide-gray-200 rounded-md border border-gray-200 lg:col-span-2">
    <li *ngFor="let e of entries" class="px-3 py-2 flex items-center gap-2 hover:bg-gray-50 cursor-pointer" (click)="open(e)">
      <span class="inline-flex items-center justify-center w-5 h-5 rounded text-gray-600">
        <i class="bx" [ngClass]="e.type === 'dir' ? 'bx-folder' : 'bx-file'" ></i>
      </span>
      <span class="text-sm text-gray-800 truncate flex-1">{{ e.name }}</span>
      <a *ngIf="e.type === 'file'" [href]="fileUrl(e)" target="_blank" class="text-xs text-blue-600 hover:underline">Open</a>
    </li>
    <li *ngIf="entries.length === 0 && !loading" class="px-3 py-2 text-sm text-gray-500">Empty</li>
  </ul>

  <div class="rounded-md border border-gray-200 p-3" *ngIf="previewUrl">
    <div class="text-sm text-gray-700 mb-2">Preview</div>
    <ng-container [ngSwitch]="previewType">
      <img *ngSwitchCase="'image'" [src]="previewUrl" alt="preview" class="max-w-full max-h-80 rounded" />
      <video *ngSwitchCase="'video'" [src]="previewUrl" controls class="w-full max-h-80 rounded"></video>
      <div *ngSwitchDefault class="text-sm text-gray-500">No preview available.</div>
    </ng-container>
    <div class="mt-3">
      <button class="inline-flex items-center px-3 py-1.5 rounded-md text-sm bg-green-600 text-white hover:bg-green-700 disabled:opacity-50"
              (click)="startTraining()" [disabled]="trainingState==='running'">
        Train
      </button>
    </div>
  </div>
</div>
