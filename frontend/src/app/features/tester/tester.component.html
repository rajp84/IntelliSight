<div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
  <div class="lg:col-span-2 space-y-2">
    <div class="border rounded p-2 bg-white">
      <div class="text-sm text-gray-600 mb-2">Preview</div>
      <div class="aspect-video w-full bg-gray-100 flex items-center justify-center rounded">
        <img *ngIf="frameSrc" [src]="frameSrc" alt="preview" class="max-h-[60vh] max-w-full rounded" />
        <span *ngIf="!frameSrc" class="text-gray-400 text-sm">Waiting for frames…</span>
      </div>
    </div>
    <div class="border rounded p-2 bg-white flex items-center justify-between">
      <div class="text-sm text-gray-600">Status: <span class="font-medium text-gray-800">{{ status?.state || 'idle' }}</span></div>
      <div class="flex items-center gap-2">
        <div class="w-40 h-2 bg-gray-200 rounded overflow-hidden" *ngIf="status?.state !== 'idle'">
          <div class="h-full bg-blue-600" [style.width.%]="status?.progress || 0"></div>
        </div>
        <div class="text-xs text-gray-500" *ngIf="status?.fps">FPS: {{ status.fps }}</div>
        <div class="text-xs text-gray-500" *ngIf="status?.queue_batch !== undefined">
          BQ: {{ status.queue_batch }}/{{ status.queue_batch_max || 0 }}
        </div>
        <div class="text-xs text-gray-500" *ngIf="status?.last_batch_size !== undefined">
          Last: {{ status.last_batch_size }} {{ status.last_batch_ms ? ('(' + status.last_batch_ms + 'ms)') : '' }}
        </div>
        <div class="text-xs text-gray-500" *ngIf="status?.queue_frames !== undefined">
          FQ: {{ status.queue_frames }}/{{ status.queue_frames_max || 0 }}
        </div>
        <div class="text-xs text-gray-500" *ngIf="status?.queue_results !== undefined">
          RQ: {{ status.queue_results }}/{{ status.queue_results_max || 0 }}
        </div>
        <button class="px-2 py-1 text-xs rounded bg-red-600 text-white hover:bg-red-700 disabled:opacity-50"
                (click)="terminate()" [disabled]="terminating || status?.state !== 'running'">
          {{ terminating ? 'Terminating…' : 'Terminate' }}
        </button>
      </div>
    </div>
  </div>
  <div class="space-y-2">
    <div class="border rounded p-2 bg-white">
        <div class="text-sm text-gray-600 mb-2">Matches ({{ matches.length || 0 }})</div>
      <div *ngIf="!matches.length" class="text-xs text-gray-400">No matches yet</div>
      <ul class="space-y-2 matches-container">
        <li *ngFor="let m of matches" class="border rounded p-2 match-item">
          <div class="flex items-start gap-2">
            <!-- Thumbnail -->
            <div class="flex-shrink-0">
              <img *ngIf="m.payload?.image_id" 
                   [src]="getThumbnailUrl(m.payload.image_id)" 
                   [alt]="m.payload?.label || 'Match'"
                   class="w-12 h-12 object-cover rounded border thumbnail"
                   (error)="onImageError($event)"
                   loading="lazy">
              <div *ngIf="!m.payload?.image_id" 
                   class="w-12 h-12 bg-gray-200 rounded border flex items-center justify-center">
                <span class="text-xs text-gray-400">No img</span>
              </div>
            </div>
            
            <!-- Match details -->
            <div class="flex-1 min-w-0">
              <div class="flex items-center justify-between">
                <div class="text-sm font-medium text-gray-800 truncate">
                  {{ m.payload?.label || 'Unknown' }}
                </div>
                <div class="similarity-badge">
                  {{ (m.similarity * 100) | number:'1.0-0' }}%
                </div>
              </div>
              <div class="text-xs text-gray-500 truncate">
                ID: {{ m.id }}
              </div>
            </div>
          </div>
        </li>
      </ul>
    </div>
  </div>
</div>
