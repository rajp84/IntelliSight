<div class="p-2">
    <h2 class="text-lg font-semibold text-gray-900 mb-2">Model Trainer</h2>
    <div class="rounded border border-gray-200 p-2 mb-3">
      <div class="text-sm text-gray-700">Status: {{ status?.state || 'idle' }}</div>
      <div class="text-sm text-gray-700">Epoch: {{ status?.epoch || 0 }} / {{ status?.epochs || 0 }}</div>
    <div class="mt-1 text-xs flex gap-3">
      <div class="px-2 py-0.5 rounded bg-gray-100 border border-gray-200">Classes: <strong>{{ status?.classes || 0 }}</strong></div>
      <div class="px-2 py-0.5 rounded bg-gray-100 border border-gray-200">Train Images: <strong>{{ status?.train_images || 0 }}</strong></div>
      <div class="px-2 py-0.5 rounded bg-gray-100 border border-gray-200">Negatives: <strong>{{ status?.negatives || 0 }}</strong></div>
      <div class="px-2 py-0.5 rounded bg-gray-100 border border-gray-200">Synthetic: <strong>{{ status?.synthetic_images || 0 }}</strong></div>
    </div>
    <div *ngIf="best" class="mt-1 text-xs">
      <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded bg-yellow-100 text-yellow-800 border border-yellow-200">Best so far</span>
      <span class="ml-2 text-gray-700">epoch {{ best.epoch }}</span>
      <span class="ml-2 text-gray-600">P: {{ best.precision | number:'1.2-2' }}</span>
      <span class="ml-2 text-gray-600">R: {{ best.recall | number:'1.2-2' }}</span>
      <span class="ml-2 text-gray-600">mAP50: {{ best.map50 | number:'1.3-3' }}</span>
      <span class="ml-2 text-gray-600">mAP50-95: {{ best.map5095 | number:'1.3-3' }}</span>
    </div>
      <div class="w-full bg-gray-200 h-2 rounded overflow-hidden my-2">
        <div class="bg-blue-600 h-2" [style.width.%]="status?.progress || 0"></div>
      </div>
      <div class="text-xs text-gray-500 truncate">{{ status?.message }}</div>
      <div class="mt-2 flex gap-2">
        <label class="text-xs text-gray-700 flex items-center gap-1">
          Epochs:
          <input type="number" min="1" [(ngModel)]="epochs" class="w-20 px-2 py-1 text-xs border border-gray-300 rounded" [disabled]="isStarting || status?.state==='running' || status?.state==='terminating'"/>
        </label>
        <label class="text-xs text-gray-700 flex items-center gap-1">
          Augment per Image:
          <input type="number" min="0" [(ngModel)]="synthPerImage" class="w-20 px-2 py-1 text-xs border border-gray-300 rounded" [disabled]="isStarting || status?.state==='running' || status?.state==='terminating'"/>
        </label>
        <label class="text-xs text-gray-700 flex items-center gap-1">
          Starting Weights:
          <select [(ngModel)]="startingWeights" class="px-2 py-1 text-xs border border-gray-300 rounded" [disabled]="isStarting || status?.state==='running' || status?.state==='terminating'">
            <option *ngFor="let m of models" [ngValue]="m.path">{{ m.name }}</option>
          </select>
        </label>
        <button class="px-3 py-1 text-xs rounded bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50" (click)="start()" [disabled]="isStarting">Start</button>
        <button *ngIf="status?.state==='running'" class="px-3 py-1 text-xs rounded bg-red-600 text-white hover:bg-red-700" (click)="terminate()">Terminate</button>
      </div>
    </div>
  <div #logContainer class="rounded border border-gray-200 p-2 pb-8 max-h-80 overflow-y-auto overflow-x-hidden text-xs bg-gray-50">
    <div *ngIf="tableRows.length > 0" class="mb-2">
      <table class="w-full text-[11px]">
        <tbody>
          <tr *ngFor="let row of tableRows; let i = index" [class.font-semibold]="i===0">
            <td *ngFor="let col of row" class="px-1 py-0.5 whitespace-nowrap border-b border-gray-200">{{ col }}</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="font-mono whitespace-pre">
      <div *ngFor="let line of logs">{{ line }}</div>
      <!-- Bottom spacer to prevent last lines being cut off -->
      <div class="h-8"></div>
    </div>
  </div>
  </div>